---
#default
layout: post
title: "ë™ì‹œì„± ë¬¸ì œ - ë°ì´í„°ë² ì´ìŠ¤ì™€ JPA (Part 2)"
date: 2020-03-06 01:31:50 +0900
categories: web
tags: concurrency architecture enterprise database jpa

#custom
post_id: 43
permalink: "/post/43"
imageurl: "/asset/media/image/post/43"
# ì‚¬ìš©ë²• : ![img-name]({{page.imageurl}}/1.png)
mainpic: "/asset/media/image/post/43/cover.jpg" #"/asset/media/image/post/31/5.png"
---

> ì‹œë¦¬ì¦ˆ
> 
> [Part 1 : ë™ì‹œì„± ë¬¸ì œ - ì¼ë°˜ë¡ ]({{site.baseurl}}/post/42)
> 
> Part 2  : ë™ì‹œì„± ë¬¸ì œ - ë°ì´í„°ë² ì´ìŠ¤ì™€ JPA **(NOW)**
> 
> [Part 3  : ë™ì‹œì„± ë¬¸ì œ - ë¹„ì¦ˆë‹ˆìŠ¤ ì• í”Œë¦¬ì¼€ì´ì…˜]({{site.baseurl}}/post/44) 


ì•ì„  ê¸€ì—ì„œ íŠ¹ì • ì‹œìŠ¤í…œì— ì¢…ì†ë˜ì§€ ì•ŠëŠ” **ë™ì‹œì„± ë¬¸ì œì˜ ì¼ë°˜ë¡ **ì— ëŒ€í•´ì„œ ì •ë¦¬í•´ë³´ì•˜ìŠµë‹ˆë‹¤. 

- ë™ì‹œì„± ë¬¸ì œëŠ” 2ê°œ ì´ìƒì˜ ì„¸ì…˜ì´ "ì½ê³  ì“°ê¸° Readâ†’Write" í•˜ë ¤ê³  í•  ë•Œ ë°œìƒí•œë‹¤.
- ë™ì‹œì„± ë¬¸ì œëŠ” í¬ê²Œ "ì¼ê´€ì„± ì—†ëŠ” ì½ê¸°" ì™€ "ì†ì‹¤ë˜ëŠ” ì—…ë°ì´íŠ¸" ë¡œ ë‚˜ë‰œë‹¤.
- "ì¼ê´€ì„± ì—†ëŠ” ì½ê¸°" ëŠ” ë¶ˆë³€ì„±-ë³µì‚¬ë³¸ìœ¼ë¡œ í•´ê²°í•œë‹¤.
- "ì†ì‹¤ë˜ëŠ” ì—…ë°ì´íŠ¸" ëŠ” ë‚™ê´€ì  ì ê¸ˆê³¼ ë¹„ê´€ì  ì ê¸ˆìœ¼ë¡œ í•´ê²°í•œë‹¤.

ì´ë²ˆ ê¸€ì—ì„œëŠ” ë°ì´í„°ë² ì´ìŠ¤ ì‹œìŠ¤í…œê³¼ JPA ì—ì„œëŠ” ë™ì‹œì„± ë¬¸ì œë¥¼ ì–´ë–»ê²Œ ì œì–´í•˜ëŠ”ì§€ ì•Œì•„ë³´ê² ìŠµë‹ˆë‹¤.

# ë°ì´í„°ë² ì´ìŠ¤ì˜ ë™ì‹œì„± ì œì–´

ë°ì´í„°ë² ì´ìŠ¤ ì‹œìŠ¤í…œì—ì„œ ì„¸ì…˜ì€ "íŠ¸ëœì­ì…˜ (Transaction)" ì…ë‹ˆë‹¤. 

Transaction ì˜ íŠ¹ì„± 4ê°€ì§€ ACID ì¤‘ Isolation ì€ ë°”ë¡œ íŠ¸ëœì­ì…˜ì˜ ë™ì‹œì„± ì œì–´ì™€ ê¹Šì´ ê´€ë ¨ì´ ìˆìŠµë‹ˆë‹¤. 

ë°”ë¡œ ì´ Isolation ì˜ ì •ë„ë¥¼ ë‚˜íƒ€ë‚´ëŠ” Isolation Level 4ê°€ì§€ê°€, ë°ì´í„°ë² ì´ìŠ¤ ë™ì‹œì„± ì œì–´ì˜ í•µì‹¬ì…ë‹ˆë‹¤. 

ê°ê°ì˜ ë ˆë²¨ì— ë”°ë¼ "ì¼ê´€ì„± ì—†ëŠ” ì½ê¸°" ì™€ "ì†ì‹¤ë˜ëŠ” ì—…ë°ì´íŠ¸" ê°€ í•´ê²°ë˜ëŠ”ì§€ í™•ì¸í•´ë³´ê² ìŠµë‹ˆë‹¤. 

Isolation Level | "ì¼ê´€ì„± ì—†ëŠ” ì½ê¸°" í•´ê²°ë˜ë‚˜? | "ì†ì‹¤ë˜ëŠ” ì—…ë°ì´íŠ¸" í•´ê²°ë˜ë‚˜? | ì¼ë°˜ë¡  | "ì •í™•ì„±ê³¼ í™œë™ì„±"
--|--|--|--
Serializable | O | O | ë¹„ê´€ì  ì ê¸ˆìœ¼ë¡œ ë‘ ë¬¸ì œ ëª¨ë‘ í•´ê²° | ì •í™•ì„±ì€ ë†’ìœ¼ë‚˜ í™œë™ì„± ë§¤ìš° ë‚®ìŒ
Repeatable Read | O | X | ë³µì‚¬ë³¸ ì‚¬ìš©ìœ¼ë¡œ "ì¼ê´€ì„± ì—†ëŠ” ì½ê¸°" í•´ê²° | ì ì ˆí•œ íƒ€í˜‘. ëŒ€ë¶€ë¶„ DBMS ì˜ ê¸°ë³¸ê°’.
Read Committed | X | X | ë³µì‚¬ë³¸ì„ ì‚¬ìš©í•˜ì§€ ì•Šì•„ì„œ ì½ê¸°ì— ì¼ê´€ì„±ì´ ì—†ìŒ | í™œë™ì„± (ë™ì‹œì„±) ì´ ë§¤ìš° ë†’ìŒ

*Read Uncommitted ë¥¼ ë…¼ì™¸ë¡œ í•œ ì´ìœ ëŠ” RDBMS í‘œì¤€ì—ì„œëŠ” ê²©ë¦¬ìˆ˜ì¤€ìœ¼ë¡œ ì¸ì •í•˜ì§€ ì•Šê¸° ë•Œë¬¸ì…ë‹ˆë‹¤.*

# JPA ì˜ ë™ì‹œì„± ì œì–´

JPA ì‹œìŠ¤í…œì—ì„œì˜ ì„¸ì…˜ì€ í•˜ë‚˜ì˜ JPA Transaction ì…ë‹ˆë‹¤. JPAì—ì„œì˜  ì½ê¸° ì“°ê¸° ë™ì‹œì„±ì€ Entity ê°ì²´ì™€ ê´€ë ¨ì´ ìˆìŠµë‹ˆë‹¤.  

Entity ê°ì²´ë¥¼ í•œë²ˆ ì¡°íšŒí•˜ë©´ JPA ì˜ ì˜ì†ì„± ì»¨í…ìŠ¤íŠ¸ (Persistance Context) ì— ìºì‹œë˜ê¸° ë•Œë¬¸ì—, ì„¸ì…˜ (JPA Transaction) ë‚´ì—ì„œì˜ "ì¼ê´€ì„± ì—†ëŠ” ì½ê¸°" ì˜ ë¬¸ì œëŠ” ì—†ìŠµë‹ˆë‹¤. 

ê·¸ë ‡ë‹¤ë©´ JPA ëŠ” "ì†ì‹¤ë˜ëŠ” ì—…ë°ì´íŠ¸" ë¬¸ì œë¥¼ ì–´ë–»ê²Œ ì œì–´í• ê¹Œìš”?  JPA ëŠ” Entity ë‹¨ìœ„ì˜ ë‚™ê´€ì  ì ê¸ˆê³¼ ë¹„ê´€ì  ì ê¸ˆì„ ì œê³µí•©ë‹ˆë‹¤. 

## JPA ë‚™ê´€ì  ì ê¸ˆ

![img-name]({{page.imageurl}}/2.png)


JPA ì˜ ë²„ì „ ê´€ë¦¬ ê¸°ëŠ¥ ( `@Version` )ì„ ì´ìš©í•´ Entity ì˜ ë²„ì „ì„ ê´€ë¦¬í•´ ë‚™ê´€ì  ì ê¸ˆì„ êµ¬í˜„í•©ë‹ˆë‹¤. Application Level ì—ì„œì˜ ì ê¸ˆì´ë©°,  ë‚™ê´€ì  ì ê¸ˆì´ë¯€ë¡œ ë‘ë²ˆì§¸ ì„¸ì…˜ì´ Write í•˜ê¸° ì „ê¹Œì§€ëŠ” ì¶©ëŒì„ ì•Œ ìˆ˜ ì—†ìŠµë‹ˆë‹¤. 


í™œë™ì„±ì€ ë†’ì¼ ìˆ˜ ìˆì§€ë§Œ, ì˜ ì§„í–‰ë˜ê³  ìˆë˜ í”„ë¡œì„¸ìŠ¤ê°€ ë³€ê²½ ì‚¬í•­ì„ ì €ì¥í•˜ë ¤ê³  í•  ë•Œ ê¹Œì§€ í”„ë¡œì„¸ìŠ¤ì˜ ì„±íŒ¨ë¥¼ ì˜ˆì¸¡í•  ìˆ˜ ì—†ë‹¤ëŠ” ê²ƒì´ ë‹¨ì ì…ë‹ˆë‹¤. 

## JPA ë¹„ê´€ì  ì ê¸ˆ

![img-name]({{page.imageurl}}/1.png)    

ë°ì´í„°ë² ì´ìŠ¤ê°€ ì œê³µí•˜ëŠ” lock ê¸°ëŠ¥ì„ ì´ìš©í•´ ì—”í‹°í‹°ë¥¼ ì˜ì† ìƒíƒœë¡œ ì˜¬ë¦´ ë•Œë¶€í„° ë‹¤ë¥¸ ì„¸ì…˜ì—ì„œ ì¡°íšŒí•˜ì§€ ëª»í•˜ë„ë¡ ì ê¸ˆì„ ê±¸ì–´ë‘¡ë‹ˆë‹¤. ( `select for update` êµ¬ë¬¸ì´ë¼ê³  ìƒê°í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. )  

ì—­ì‹œ ë¹„ê´€ì  ì ê¸ˆì¸ë§Œí¼, í™œë™ì„±ì€ ë§¤ìš° ì €í•˜ë˜ì§€ë§Œ ì •í™•ì„±ê³¼ ì„¸ì…˜ì˜ ì„±ê³µì€ ë³´ì¥ë©ë‹ˆë‹¤. 

> ğŸ’¡ ë‹¤ìŒ ê¸€  : [ë™ì‹œì„± ë¬¸ì œ - ë¹„ì¦ˆë‹ˆìŠ¤ ì• í”Œë¦¬ì¼€ì´ì…˜ (Part 3)]({{site.baseurl}}/post/44)