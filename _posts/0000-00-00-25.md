---
#default
layout : post
title : "Javascript Runtime ì˜ êµ¬ì¡°"
date : 2018-05-17 19:11:50 +0900
categories : language
tags: javascript nodejs runtime promise eventloop

#custom
post_id : 25
permalink : "/post/25"
imageurl : "/asset/media/image/post/25"
mainpic : "/asset/media/image/post/25/cover.jpeg"
---

Javascript ëŠ” ë‹¤ë¥¸ ë§ì€ ì–¸ì–´ë“¤ê³¼ ë‹¤ë¥´ê²Œ êµ‰ì¥íˆ ë‹¤ì–‘í•œ Runtime(=ì‹¤í–‰í™˜ê²½) ì†ì—ì„œ ì‹¤í–‰ëœë‹¤.

ë‹¤ë¥¸ ì–¸ì–´ ì˜ˆë¥¼ ë“¤ìë©´, Python ì€ ê³µì‹ interpreter ê°€ ì£¼ê¸°ì ìœ¼ë¡œ ì—…ë°ì´íŠ¸ë˜ë©°, ëª¨ë“  íŒŒì´ì¬ ì½”ë“œ ì‘ì„±ìëŠ” Python ê³µì‹ Interpreter ë¥¼ ì´ìš©í•œë‹¤. Java ë˜í•œ ê³µì‹ JDK ê°€ ë°°í¬ ë° ê´€ë¦¬ë˜ê³ , ìë°” ê°œë°œìëŠ” ë‹¤ë¥¸ ê°œë°œìë“¤ì´ ëª¨ë‘ JVM ì´ë¼ëŠ” ë™ì¼í•œ Java Runtime ì„ ì´ìš©í•œë‹¤ê³  ê°€ì •í•˜ê³  ê°œë°œí•œë‹¤.

ë°˜ë©´ì— Javascript ëŠ” ê°™ì€ ì½”ë“œì—¬ë„, Runtime ì— ë”°ë¼ ì‹¤í–‰ ì–‘ìƒì´ ë‹¤ë¥¼ ìˆ˜ ìˆë‹¤.

ê·¸ëŸ¼ì—ë„ ëª¨ë“  Javascript Runtime ë“¤ì€ ë¹„ìŠ·í•œ êµ¬ì¡°ì™€ ë™ì‘ë°©ì‹ì„ ê°€ì§€ê³  ìˆë‹¤. ê°€ì¥ ëŒ€ì¤‘ì ì¸ Runtime ì¸ NodeJS ë¶€í„° ë¸Œë¼ìš°ì €ì— ë‚´ì¥ëœ Runtime ê¹Œì§€, ê¸°ë³¸ í‹€ì€ ë¹„ìŠ·í•˜ë‹¤.

ê·¸ë¦¬ê³  Javascript Runtime ë“¤ì˜ ê³µí†µì ì¸ ë™ì‘ë°©ì‹ì„ ì•„ëŠ” ê²ƒì€ Javascript ì½”ë“œë¥¼ ì§œëŠ”ë°ì— ë§¤ìš° ë„ì›€ì´ ëœë‹¤. ë§Œì•½ Callback Pattern ì˜ ì½”ë“œì—ì„œ Promise ë‚˜ async-await Pattern ì˜ ì½”ë“œë¡œ ë„˜ì–´ê°€ê³  ì‹¶ì–´ë„, Javascript Runtime ì˜ ë™ì‘ë°©ì‹ì„ ëª¨ë¥´ë©´ ì‰½ì‚¬ë¦¬ ë„˜ì–´ê°ˆ ìˆ˜ ì—†ë‹¤.

ê·¸ë˜ì„œ ì´ë²ˆ ê¸€ì—ì„œëŠ” Javascript Runtime ì˜ ê³µí†µì ì¸ êµ¬ì¡°ë¥¼ íŒŒì•…í•´ë³´ë ¤ê³  í•œë‹¤.

# ğŸ Runtime ê¸°ë³¸ 4 ìš”ì†Œ
![](/asset/media/image/post/25/18.png)

Javascript Runtime ëŠ” í° 4ê°€ì§€ ìš”ì†Œë¡œ ë‚˜ëˆŒ ìˆ˜ ìˆëŠ”ë° ì´ëŠ” ì•„ë˜ì™€ ê°™ë‹¤.


1. Javascript Engine : Call Stack , Heap Memory 
2. Background : ë¹„ë™ê¸° task ë¥¼ ìˆ˜í–‰í•˜ëŠ” Multi Threads
3. ì—¬ëŸ¬ Task Queue : Background ì‘ì—… ìˆ˜í–‰ í›„ Callback ì„ ê´€ë¦¬ 
4. Event Loop : Single Thread, Non-blocking IO ì˜ ì±…ì„ 


êµ¬ì„± ìš”ì†Œë“¤ì„ í•˜ë‚˜í•˜ë‚˜ ì‚´í´ë³´ì.

## ìš”ì†Œ 1. Javascript Engine
![](/asset/media/image/post/25/16.png)

Node Js ë‚˜ ë¸Œë¼ìš°ì €ì™€ ê°™ì€ Javascript Runtime ì— í¬í•¨ë˜ì–´ìˆëŠ” Javascript Engine ì€ ì½”ë“œë¥¼ ì½ëŠ” Interpreter, ì½”ë“œë¥¼ ë°”íƒ•ìœ¼ë¡œ í˜„ì¬ ì‹¤í–‰ì¤‘ì¸ ì„œë¸Œë£¨í‹´ì„ ê´€ë¦¬í•˜ëŠ” Call Stack, ê·¸ë¦¬ê³  ë³€ìˆ˜ì™€ ê°ì²´ì— ëŒ€í•œ ë©”ëª¨ë¦¬ í• ë‹¹ ë° ê´€ë¦¬ë¥¼ ë‹´ë‹¹í•˜ëŠ” Heap Memory ë¡œ êµ¬ì„±ë˜ì–´ìˆë‹¤. 

ìë°”ìŠ¤í¬ë¦½íŠ¸ ì—”ì§„ì€ ì€ `.js`íŒŒì¼ì„ ì½ìœ¼ë©´ì„œ Call stack ì„ ì±„ìš°ê³ , Call stack ì— ìˆëŠ” ì‘ì—…ë“¤ì„ ìˆ˜í–‰í•˜ê¸°ë¥¼ ë°˜ë³µí•œë‹¤.

> ì—”ì§„ì— ë”°ë¼ ì™¸ë¶€ ëª¨ë“ˆì„ ì½ì–´ë“¤ì´ëŠ” ê³¼ì •ë„ ìˆ˜í–‰í•œë‹¤. (ex : `require('https')` , `import 'https'`)



## ìš”ì†Œ 2,3. Background ì™€ Task Queue
![](/asset/media/image/post/25/19.png)

JS Engine ì—ì„œ ì½”ë“œë¥¼ ìˆ˜í–‰í•˜ë‹¤ê°€, ë‹¤ìŒê³¼ ê°™ì€ Background API ë¥¼ í˜¸ì¶œí•˜ê²Œ ë˜ë©´, Background ì‘ì—…ì´ ì‹œì‘ëœë‹¤.

1. Timer ì‘ì—… (`setTimeout(cb, 10 , ...args)` ë“±ìœ¼ë¡œ í˜¸ì¶œ)
2. eventListener ì‘ì—… (`onClick(cb, ...args)` ë“±ìœ¼ë¡œ í˜¸ì¶œ)
3. Promise  

ê° Background ì‘ì—…ì„ ë§ˆì¹˜ë©´, APIê°€ í˜¸ì¶œë  ë•Œ ì „ë‹¬ë°›ì€ callback(Task) ì„ Task Queue ì— ì‚½ì…í•˜ê¸° ìœ„í•´ Event Loop ì—ê²Œ ì „ë‹¬í•œë‹¤.

ì‘ì—…|callback ì „ë‹¬
--|--
Timer ì‘ì—… | timer ë™ì‘ì´ ëë‚˜ë©´ í•¨ê»˜ ì „ë‹¬ë°›ì€ callback ì„ ì „ë‹¬í•œë‹¤
eventListener ì‘ì—… | ì´ë²¤íŠ¸ë¥¼ ê°ì§€í•˜ë©´ ì „ë‹¬ë°›ì€ callback ì„ ì „ë‹¬í•œë‹¤
Promise | Promise ì•ˆì— ë‹´ê¸´ ì‘ì—…ì„ ìˆ˜í–‰ ì™„ë£Œí•˜ë©´ `.then()` ë¡œ ì „ë‹¬ë°›ì€ callback ì„ ì „ë‹¬í•œë‹¤


## ìš”ì†Œ 4. Event Loop
![](/asset/media/image/post/25/15.png)

Event Loop ëŠ” Javascript Runtime ì˜ ì¤‘ì‹¬ì—ì„œ Call Stack ê³¼ Background ê°„ì˜ ì—…ë¬´ ì²˜ë¦¬ë¥¼ ë•ëŠ” ì¤‘ê°œì ì—­í• ì„ í•œë‹¤. ë¬´í•œ ë£¨í”„ë¥¼ ëŒë©´ì„œ Callback(Task) ë¥¼ Background ì—ì„œ Task Queue ë¡œ, Task Queue ì—ì„œ Engine ì˜ Call stack ìœ¼ë¡œ ì ì ˆíˆ ì „ë‹¬í•œë‹¤. Single Thread ë¡œ êµ¬ì„±ë˜ì–´ìˆê³ , Background ì˜ ì‘ì—… ìˆ˜í–‰ì„ ê¸°ë‹¤ë¦¬ì§€ ì•Šê¸° ë•Œë¬¸ì— Non-Blocking ì˜ íŠ¹ì§•ì„ ê°€ì§€ê³  ìˆë‹¤. 



### ì°¸ê³  : ìš”ì†Œë³„ ë‹¨ì¼/ë©€í‹° Thread
Javascript Engine ê³¼ Event Loop ëŠ” ë‹¨ì¼ Thread ì´ê³ , Background ëŠ” (ì‚¬ì‹¤ìƒ) Multi Thread ì´ë‹¤. 

ìš”ì†Œ|Thread|íŠ¹ì§•
--|--|--
Javascript Engine | ë‹¨ì¼ Thread | javascript ì½”ë“œë¥¼ í•œ ì¤„ì”© ì½ìœ¼ë©´ì„œ ì‘ì—…ì„ ìˆ˜í–‰í•œë‹¤.
Background | (ì¼ì¢…ì˜) ë©€í‹° Thread | Engine ì´ ì½”ë“œë¥¼ ìˆ˜í–‰í•˜ëŠ” ë™ì•ˆ, API í˜¸ì¶œì„ í†µí•´ ì „ë‹¬ë°›ì€ ì‘ì—…ì„ ë©€í‹° Thread ì—ì„œ ë™ì‹œë‹¤ë°œì ìœ¼ë¡œ ìˆ˜í–‰í•œë‹¤.
Event Loop | ë‹¨ì¼ Thread | ë‹¨ì¼ Thread ìœ„ì—ì„œ ë¬´í•œ ë£¨í”„ê°€ ëŒë©° ë‚˜ë¨¸ì§€ 3ìš”ì†Œë¥¼ ê´€ë¦¬í•œë‹¤.

# ğŸ–¼ ê·¸ë¦¼ìœ¼ë¡œ ì•Œì•„ë³´ëŠ” Javascript Runtime ë™ì‘ 
ë‹¤ìŒì€ ìë°”ìŠ¤í¬ë¦½íŠ¸ ì½”ë“œê°€ Runtime ì—ì„œ ì–´ë–»ê²Œ ìˆ˜í–‰ë˜ëŠ”ì§€ ìˆœì„œëŒ€ë¡œ ë‚˜íƒ€ë‚¸ ê²ƒì´ë‹¤. 
![](/asset/media/image/post/25/11.png)
![](/asset/media/image/post/25/12.png)
![](/asset/media/image/post/25/13.png)
![](/asset/media/image/post/25/14.png)

# ğŸ“Œ ë†“ì¹˜ê¸° ì‰¬ìš´ í¬ì¸íŠ¸ : Promise ë¡œ ë¶€í„° ì „ë‹¬ëœ Micro Task ëŠ” ìš°ì„  ì²˜ë¦¬

Task Queue ë¶€ë¶„ì€ ì—¬ëŸ¬ ì¢…ë¥˜ì˜ Task Queue ë¥¼ ê°€ì§€ê³  ìˆëŠ”ë°, Javascript ì˜ Promise ë¬¸ë²•ì„ ì§€ì›í•˜ëŠ” ìµœê·¼ì˜ javascript runtime ë“¤ì€ Micro Task Queue ë¥¼ ê°€ì§„ë‹¤.

Background ì˜ Promise ë¡œë¶€í„° ì „ë‹¬ëœ callback(task)ëŠ” Micro Task Queue ì— ìŒ“ì´ê³ , JS Engine ì˜ Call Stack ì´ ë¹„ì—ˆì„ ë•Œ Task Queue ë³´ë‹¤ ìš°ì„ ì ìœ¼ë¡œ Micro Task Queue ì˜ task ë¥¼ ë¨¼ì € ìˆ˜í–‰í•œë‹¤.

ì•„ë˜ëŠ” ê·¸ ì˜ˆì‹œì´ë‹¤.

```javascript

console.log("1") ;

setTimeout( _ => {console.log("setTimeout");}, 0) ;

console.log("2") ;

Promise.resolve().then(_ => {
  console.log("promise1");
}).then( _ => {
  console.log("promise2");
});

console.log("3") ;

```

ì´ ì½”ë“œë¥¼ ì‹¤í–‰ì‹œí‚¤ë©´ ì½˜ì†”ì—” ì•„ë˜ì™€ ê°™ì´ ì°íŒë‹¤.

```Javascript
1
2
3
promise1
promise2
setTimeout
```
1,2,3 ê°€ ë¨¼ì € ì°íŒ ê²ƒì€ javascript engine ì´ `setTimeout` ì´ë‚˜ `Promise.resolve().then(...)` ì²˜ëŸ¼ Background ì˜ ì‘ì—…ì„ ê¸°ë‹¤ë¦¬ì§€ ì•Šê³  (ë¹„ë™ê¸°ì ) ë‹¤ìŒ ì½”ë“œë¥¼ ìš°ì„ ì ìœ¼ë¡œ ì‹¤í–‰í•˜ëŠ” ê²ƒì„ ë³´ì—¬ì¤€ë‹¤.

ì½”ë“œê°€ ì‹¤í–‰ë˜ëŠ” ë™ì•ˆ event loop ì™€ background ì—ì„œëŠ” ì—´ì‹¬íˆ timer ì‘ì—…ê³¼ promise ì‘ì—…ì„ ìˆ˜í–‰í•  ê²ƒì´ê³ , call stack ì´ ë‹¤ ë¹„ì›Œì§„ ì‹œì ì— micro task queue ì™€ task queue ëŠ” ì•„ë˜ì™€ ê°™ì„ ê²ƒì´ë‹¤.

Micro Task Queue | Task Queue
--|--
`_ => {console.log("promise1");}` |`_ =>{console.log("setTimeout");}`
`_ => {console.log("promise2");}` |


ì´ ë•Œ micro task queue ì— ìˆëŠ” task(callback) ë“¤ì´ ìš°ì„ ì ìœ¼ë¡œ engine ì˜ call stack ìœ¼ë¡œ (event loop ì— ì˜í•´) ì „ë‹¬ë˜ê³ , ìš°ì„ ì ìœ¼ë¡œ ìˆ˜í–‰ëœë‹¤.

micro task queue ê°€ ë‹¤ ë¹„ì›Œì§„ í›„ì—ëŠ” task queue ì˜ ì‘ì—…ë“¤ì´ ì˜®ê²¨ì§€ê³  ìˆ˜í–‰ëœë‹¤.
